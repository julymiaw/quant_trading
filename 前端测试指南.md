# 量化交易系统前端测试指南

## 前置条件

### 1. 启动后端服务
```bash
python app.py
```
后端服务将在 `http://localhost:5000` 启动

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```
前端服务将在 `http://localhost:3000` 启动

### 3. 初始化数据库（如果没有数据）
```bash
python init_db_simple.py
```

---

## 测试流程

### 第一步：用户登录测试

1. **打开页面**: 访问 `http://localhost:3000`，会自动跳转到登录页面
2. **登录位置**: 在登录表单中输入以下信息：
   - **用户名**: `system`
   - **密码**: `system123`
3. **点击登录按钮**
4. **期望结果**: 成功登录并跳转到主页面

---

### 第二步：指标管理测试

#### 2.1 查看指标列表
1. **导航到指标管理**: 在左侧菜单点击"指标管理"
2. **查看列表**: 应该能看到系统指标列表
3. **测试筛选**:
   - 在筛选下拉框选择"系统指标"
   - 在搜索框输入"MACD"进行搜索

#### 2.2 创建新指标
1. **点击"添加指标"按钮**
2. **在弹窗中填写**:
   - **指标名称**: `TEST_RSI`
   - **计算方法**:
     ```python
     def calculation_method(params):
         close = params["daily.close"]
         return 50.0  # 简化的RSI计算
     ```
   - **指标说明**: `测试RSI指标`
   - **状态**: 启用
3. **点击保存**
4. **期望结果**: 指标创建成功，列表中显示新指标

#### 2.3 测试指标状态切换
1. **找到刚创建的指标**
2. **点击状态开关**（切换启用/禁用）
3. **期望结果**: 状态成功切换，显示成功提示

#### 2.4 测试指标删除
1. **找到测试指标**
2. **点击删除按钮**
3. **在确认对话框点击确定**
4. **期望结果**: 指标删除成功，从列表中消失

---

### 第三步：参数管理测试

#### 3.1 查看参数列表
1. **导航到参数管理**: 在左侧菜单点击"参数管理"
2. **查看列表**: 应该能看到系统参数列表
3. **测试筛选**:
   - 参数类型选择"我的参数"
   - 参数来源类型选择"数据表"

#### 3.2 创建新参数
1. **点击"添加参数"按钮**
2. **在弹窗中填写**:
   - **参数ID**: `test_close_5`
   - **参数类型**: 数据表
   - **数据来源ID**: `daily.close`
   - **聚合函数**: `SMA`
   - **向前取历史天数**: `5`
   - **向后预测天数**: `0`
3. **点击保存**
4. **期望结果**: 参数创建成功

#### 3.3 测试参数编辑
1. **找到刚创建的参数**
2. **点击编辑按钮**
3. **修改向前取历史天数为**: `10`
4. **点击保存**
5. **期望结果**: 参数更新成功

---

### 第四步：策略管理测试

#### 4.1 查看策略列表
1. **导航到策略管理**: 在左侧菜单点击"策略管理"
2. **查看列表**: 应该能看到系统策略
3. **测试筛选**:
   - 策略类型选择"系统策略"
   - 生效范围选择"全部股票"

#### 4.2 创建新策略
1. **点击"添加策略"按钮**
2. **填写基本信息**:
   - **策略名称**: `测试均线策略`
   - **策略描述**: `简单的双均线策略测试`
   - **是否公开**: 勾选
   - **生效范围**: 全部股票
   - **持仓数量**: `10`
   - **调仓间隔**: `5`
   - **买入手续费**: `0.0003`
   - **卖出手续费**: `0.0013`

3. **填写选股函数**:
   ```python
   def select_func(context, data):
       # 简单的选股逻辑
       stocks = context.get_universe()
       
       # 获取收盘价
       close_prices = data.get_current_data(stocks, 'close')
       
       # 选择前10只股票
       selected = list(close_prices.keys())[:10]
       
       # 等权重分配
       weights = {}
       weight_per_stock = 1.0 / len(selected)
       for stock in selected:
           weights[stock] = weight_per_stock
       
       return weights
   ```

4. **填写风控函数**:
   ```python
   def risk_control_func(context, data):
       # 简单的止损逻辑
       current_positions = context.get_positions()
       
       for stock, position in current_positions.items():
           current_price = data.get_current_price(stock)
           cost_price = position.cost_price
           
           # 如果亏损超过10%，则卖出
           if current_price < cost_price * 0.9:
               context.sell_all(stock)
       
       return context.get_positions()
   ```

5. **点击保存**
6. **期望结果**: 策略创建成功

#### 4.3 查看策略详情
1. **在策略列表中点击策略名称**
2. **进入策略详情页面**
3. **检查各项信息是否正确显示**

#### 4.4 编辑策略代码
1. **在策略详情页面点击"编辑代码"标签**
2. **修改选股函数持仓数量为8**:
   ```python
   # 选择前8只股票
   selected = list(close_prices.keys())[:8]
   ```
3. **点击保存代码**
4. **期望结果**: 代码保存成功

#### 4.5 策略参数管理
1. **切换到"参数管理"标签**
2. **点击"添加参数"**
3. **选择之前创建的参数**: `system_test_close_5`
4. **点击添加**
5. **期望结果**: 参数关联成功

---

## 常见问题及解决方案

### 问题1: 登录失败 "用户不存在或密码错误"
**解决方案**: 
1. 确认使用正确的用户名密码：`system` / `system123`
2. 检查后端服务是否启动
3. 运行数据库初始化脚本

### 问题2: "获取指标列表失败"
**解决方案**:
1. 检查浏览器开发者工具Network面板，查看API请求响应
2. 确认后端服务正常运行
3. 检查token是否有效（重新登录）

### 问题3: "指标不存在"（删除/状态切换时）
**解决方案**:
1. 刷新页面重新获取指标列表
2. 确认指标ID格式正确（现在使用 `creator_name.indicator_name` 格式）

### 问题4: 代码保存失败
**检查要点**:
1. 确保代码语法正确
2. 函数名必须是 `select_func` 和 `risk_control_func`
3. 参数名必须是 `context, data`

---

## 数据验证检查点

### 登录成功后检查:
- [ ] 右上角显示用户名
- [ ] 左侧菜单显示完整
- [ ] localStorage中存在token和userInfo

### 指标管理检查:
- [ ] 能正常显示指标列表
- [ ] 搜索和筛选功能正常
- [ ] 创建指标成功
- [ ] 状态切换正常
- [ ] 删除功能正常

### 参数管理检查:
- [ ] 能正常显示参数列表
- [ ] 数据源自动完成功能正常
- [ ] 创建参数成功
- [ ] 编辑参数成功

### 策略管理检查:
- [ ] 能正常显示策略列表
- [ ] 创建策略成功
- [ ] 查看策略详情正常
- [ ] 代码编辑功能正常
- [ ] 参数关联功能正常

---

## 调试技巧

### 前端调试:
1. **打开浏览器开发者工具 (F12)**
2. **查看Console面板**: 检查JavaScript错误
3. **查看Network面板**: 检查API请求和响应
4. **查看Application面板**: 检查localStorage中的token和用户信息

### API调试:
1. **直接访问**: `http://localhost:5000/health` 检查后端服务
2. **查看后端日志**: 终端中的Flask输出日志
3. **使用浏览器直接测试API**: 
   - GET请求可直接在浏览器地址栏访问
   - POST请求需要使用开发者工具或Postman

### 数据库调试:
连接到MySQL检查数据:
```sql
USE quantitative_trading;
SELECT * FROM User WHERE user_name = 'system';
SELECT * FROM Indicator;
SELECT * FROM Param;
SELECT * FROM Strategy;
```

---

通过以上测试流程，可以全面验证系统的指标管理、参数管理和策略管理功能是否正常工作。