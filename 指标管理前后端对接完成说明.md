# 指标管理前后端对接完成说明

## 已完成的工作

### 1. 后端 Flask API 实现

#### 指标基础 CRUD 操作
- **GET /api/indicators**: 获取指标列表，支持分页、搜索、筛选
  - 支持按创建者筛选 (`creator_name`)
  - 支持按指标名搜索 (`search`)
  - 支持按状态筛选 (`is_enabled`)
  - 分页参数: `page`, `limit`

- **POST /api/indicators**: 创建新指标
  - 验证指标名称唯一性
  - 自动设置创建者信息
  - 支持指标描述、计算方法、分类等字段

- **PUT /api/indicators/{creator_name}_{indicator_name}**: 更新指标
  - 权限检查（只能修改自己创建的指标）
  - 支持更新指标名称（会同步更新关联的参数关系）
  - 字段验证和数据清理

- **DELETE /api/indicators/{creator_name}_{indicator_name}**: 删除指标
  - 权限检查
  - 检查参数依赖关系
  - 级联删除相关的指标参数关系

#### 指标状态管理
- **PUT /api/indicators/{creator_name}_{indicator_name}/toggle-status**: 切换指标启用/禁用状态
  - 权限检查
  - 自动更新时间戳

#### 指标参数关系管理
- **GET /api/indicator-param-relations**: 获取指标参数关系列表
  - 支持多条件筛选
  - 分页支持
  - 关联查询指标和参数详情

- **POST /api/indicator-param-relations**: 创建指标参数关系
  - 验证指标和参数存在性
  - 防止重复关系

- **DELETE /api/indicator-param-relations/{relation_id}**: 删除指标参数关系
  - 复合ID解析
  - 存在性验证

### 2. 前端 Vue 组件更新

#### 数据获取和展示
- 替换模拟数据为真实 API 调用
- 实现分页、搜索、筛选功能
- 添加 JWT 认证 header
- 错误处理和用户友好提示

#### 字段映射处理
- 后端字段 `is_enabled` ↔ 前端字段 `is_active`
- 后端字段 `indicator_desc` ↔ 前端字段 `description`
- 后端字段 `creation_time` ↔ 前端字段 `create_time`
- 复合主键 ID 生成: `{creator_name}_{indicator_name}`

#### 用户交互功能
- 指标创建/编辑/删除
- 状态切换（启用/禁用）
- 权限控制（只能操作自己创建的指标）
- 搜索防抖（500ms）
- 实时筛选和分页

#### 错误处理
- HTTP 状态码处理
- 401 未授权自动跳转登录页
- 详细的错误信息展示
- 网络错误兜底处理

### 3. 认证和权限

#### JWT 令牌处理
- 所有 API 请求自动添加 Authorization header
- 令牌失效自动跳转登录页面
- 用户信息从 localStorage 获取

#### 权限控制
- 用户只能编辑/删除自己创建的指标
- 系统指标不允许编辑
- 操作权限在前端 UI 和后端 API 双重控制

### 4. 数据验证

#### 后端验证
- 必填字段检查
- 数据类型验证
- 业务逻辑验证（唯一性、依赖关系等）
- SQL 注入防护

#### 前端验证
- 表单字段验证
- 用户输入清理
- 实时验证反馈

## API 接口文档

### 指标管理接口

| 方法 | 路径 | 功能 | 参数 |
|-----|------|------|------|
| GET | `/api/indicators` | 获取指标列表 | page, limit, creator_name, search, is_enabled |
| POST | `/api/indicators` | 创建指标 | indicator_name, calculation_method, indicator_desc, indicator_category, is_enabled |
| PUT | `/api/indicators/{id}` | 更新指标 | 同创建参数 |
| DELETE | `/api/indicators/{id}` | 删除指标 | - |
| PUT | `/api/indicators/{id}/toggle-status` | 切换状态 | - |

### 指标参数关系接口

| 方法 | 路径 | 功能 | 参数 |
|-----|------|------|------|
| GET | `/api/indicator-param-relations` | 获取关系列表 | page, limit, indicator_creator, indicator_name, param_creator, param_name |
| POST | `/api/indicator-param-relations` | 创建关系 | indicator_creator_name, indicator_name, param_creator_name, param_name |
| DELETE | `/api/indicator-param-relations/{id}` | 删除关系 | - |

## 使用说明

### 启动后端服务
```bash
cd c:\Users\limingyang\Desktop\quant_trading-main
python app.py
```

### 前端页面访问
打开浏览器访问前端页面的指标管理模块，确保已登录。

### 功能测试
1. 查看指标列表
2. 创建新指标
3. 编辑现有指标
4. 切换指标状态
5. 删除指标
6. 搜索和筛选功能

## 注意事项

1. **数据库连接**: 确保 MySQL 数据库正在运行且连接配置正确
2. **JWT 令牌**: 需要先登录获取有效的 JWT 令牌
3. **权限控制**: 用户只能操作自己创建的指标
4. **依赖关系**: 删除指标前需确保没有参数在引用该指标
5. **错误处理**: 所有操作都有完善的错误处理和用户提示

## 完成状态

✅ 指标列表获取 API  
✅ 指标创建 API  
✅ 指标更新 API  
✅ 指标删除 API  
✅ 指标状态切换 API  
✅ 指标参数关系管理 API  
✅ 前端组件更新  
✅ 字段映射处理  
✅ JWT 认证集成  
✅ 错误处理优化  

所有指标管理功能已完成前后端对接，可以进行完整的功能测试。